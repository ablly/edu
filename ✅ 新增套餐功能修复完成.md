# æ–°å¢å¥—é¤åŠŸèƒ½ä¿®å¤å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ é—®é¢˜æ€»ç»“

ç”¨æˆ·å¤šæ¬¡æŠ¥å‘Š"åˆ›å»ºå¥—é¤å¤±è´¥"ï¼Œè¡¨å•æ•°æ®æ— æ³•æ­£ç¡®æäº¤åˆ°åç«¯ã€‚

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### 1. **è¡¨å•æ•°æ®æ”¶é›†é—®é¢˜**
- **åŸå› **: ä½¿ç”¨ `form.validateFields()` åªèƒ½è·å–**å½“å‰å¯è§**çš„è¡¨å•å­—æ®µ
- **å½±å“**: åœ¨ç¬¬3æ­¥æäº¤æ—¶ï¼Œç¬¬1æ­¥å’Œç¬¬2æ­¥çš„å­—æ®µä¸å¯è§ï¼Œå¯¼è‡´ `name`ã€`code`ã€`price` ç­‰å…³é”®å­—æ®µä¸ºç©º
- **åç«¯æ—¥å¿—è¯æ®**:
  ```
  åˆ›å»ºå¥—é¤è¯·æ±‚æ•°æ®: {
    'is_active': True, 
    'features': ['ai'], 
    'level': 0,
    // âŒ name=None, code=None - ç¼ºå¤±
  }
  å¿…å¡«å­—æ®µç¼ºå¤±: name=None, code=None
  ```

### 2. **è¡¨å•åˆå§‹å€¼ä¸å®Œæ•´**
- **åŸå› **: `initialValues` åªè®¾ç½®äº†éƒ¨åˆ†å¸ƒå°”å­—æ®µï¼Œç¼ºå°‘æ•°å€¼å­—æ®µçš„åˆå§‹å€¼
- **å½±å“**: `price`ã€`duration_days`ã€`sort_order` ç­‰å­—æ®µå¯èƒ½è¿”å› `undefined`

### 3. **API å‡½æ•°å¯¼å…¥ç¼ºå¤±**
- **åŸå› **: `memberships.ts` æ–‡ä»¶ç¼ºå°‘ `post` å‡½æ•°å¯¼å…¥
- **å½±å“**: åˆ›å»ºå¥—é¤çš„ API è°ƒç”¨æ— æ³•æ‰§è¡Œ
- **å·²ä¿®å¤**: âœ…

## âœ… å·²å®æ–½çš„ä¿®å¤æ–¹æ¡ˆ

### 1. **ä¿®å¤ API å¯¼å…¥** âœ…
```typescript
// admin-frontend/src/api/memberships.ts
import { get, put, del, post } from '../utils/request';  // æ·»åŠ äº† post
```

### 2. **å®Œå–„è¡¨å•åˆå§‹å€¼** âœ…
```typescript
// admin-frontend/src/components/CreateTierWizard.tsx
initialValues={{
  duration_days: 30,      // âœ… æ–°å¢
  price: 0,               // âœ… æ–°å¢
  sort_order: 0,          // âœ… æ–°å¢
  is_active: true,
  is_limited: false,
  is_early_bird: false,
  total_quota: 0,
  early_bird_tier: 0,
  original_price: 0,
}}
```

### 3. **æ”¹è¿›æ•°æ®æ”¶é›†é€»è¾‘** âœ…
```typescript
// åŸä»£ç ï¼šåªè·å–å¯è§å­—æ®µ
const values = await form.validateFields();

// ä¿®å¤åï¼šè·å–æ‰€æœ‰å­—æ®µå¹¶æ˜¾å¼æ„é€  payload
const allValues = form.getFieldsValue();

const payload = {
  name: allValues.name,
  code: allValues.code,
  description: allValues.description,
  price: Number(allValues.price),
  duration_days: Number(allValues.duration_days || 30),
  features,
  level: 0,
  is_active: allValues.is_active ?? true,
  is_limited: allValues.is_limited ?? false,
  is_early_bird: allValues.is_early_bird ?? false,
  total_quota: Number(allValues.total_quota) || 0,
  early_bird_tier: Number(allValues.early_bird_tier) || 0,
  original_price: Number(allValues.original_price) || 0,
  sort_order: Number(allValues.sort_order) || 0,
};
```

### 4. **å¢å¼ºé”™è¯¯æç¤ºå’ŒéªŒè¯** âœ…
```typescript
// éªŒè¯å¿…å¡«å­—æ®µ
if (!allValues.name || !allValues.code || !allValues.description) {
  message.error('è¯·è¿”å›ç¬¬1æ­¥å®ŒæˆåŸºæœ¬ä¿¡æ¯çš„å¡«å†™');
  setCurrentStep(0);  // è‡ªåŠ¨è·³è½¬åˆ°ç¬¬1æ­¥
  return;
}

if (!allValues.price || allValues.price <= 0) {
  message.error('è¯·è¿”å›ç¬¬2æ­¥è®¾ç½®æ­£ç¡®çš„ä»·æ ¼');
  setCurrentStep(1);  // è‡ªåŠ¨è·³è½¬åˆ°ç¬¬2æ­¥
  return;
}
```

### 5. **å¢å¼ºè°ƒè¯•æ—¥å¿—** âœ…
```typescript
console.log('=== å¼€å§‹åˆ›å»ºå¥—é¤ ===');
console.log('å½“å‰åŠŸèƒ½åˆ—è¡¨:', features);
console.log('æ‰€æœ‰è¡¨å•å€¼:', allValues);
console.log('å‡†å¤‡æäº¤çš„å®Œæ•´æ•°æ®:', payload);
console.log('=== å¼€å§‹è°ƒç”¨API ===');
```

## ğŸš€ ä½¿ç”¨è¯´æ˜

### **åˆ›å»ºå¥—é¤çš„æ­£ç¡®æ­¥éª¤**ï¼š

1. **åˆ·æ–°é¡µé¢** (F5 æˆ– Ctrl+F5) ç¡®ä¿åŠ è½½æœ€æ–°ä»£ç 
2. **ç‚¹å‡»"æ–°å¢å¥—é¤"æŒ‰é’®**
3. **ç¬¬1æ­¥ - åŸºæœ¬ä¿¡æ¯**:
   - å¥—é¤åç§°ï¼šå¿…å¡«ï¼ˆä¾‹å¦‚ï¼šAIæ™ºèƒ½å¥—é¤ï¼‰
   - å¥—é¤ä»£ç ï¼šå¿…å¡«ï¼ˆä¾‹å¦‚ï¼šai_smart_2025ï¼Œåªèƒ½åŒ…å«å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼‰
   - å¥—é¤æè¿°ï¼šå¿…å¡«ï¼ˆä¾‹å¦‚ï¼šåŒ…å«AIæ™ºèƒ½ç­”ç–‘åŠŸèƒ½ï¼‰
4. **ç¬¬2æ­¥ - ä»·æ ¼è®¾ç½®**:
   - ä»·æ ¼ï¼šå¿…å¡«ï¼Œå¿…é¡»å¤§äº0ï¼ˆä¾‹å¦‚ï¼š29.90ï¼‰
   - æœ‰æ•ˆæœŸï¼šå¿…å¡«ï¼Œé»˜è®¤30å¤©
   - å…¶ä»–é€‰é¡¹ï¼šå¯é€‰ï¼ˆæ—©é¸Ÿä¼˜æƒ ã€é™é‡ã€åŸä»·ç­‰ï¼‰
5. **ç¬¬3æ­¥ - å¥—é¤åŠŸèƒ½**:
   - è¾“å…¥åŠŸèƒ½æè¿°ï¼Œç‚¹å‡»"æ·»åŠ "
   - è‡³å°‘æ·»åŠ ä¸€ä¸ªåŠŸèƒ½
   - å¯ä»¥åˆ é™¤å·²æ·»åŠ çš„åŠŸèƒ½
6. **ç‚¹å‡»"åˆ›å»ºå¥—é¤"**

### **éªŒè¯æˆåŠŸçš„æ ‡å¿—**ï¼š

âœ… **æµè§ˆå™¨æ§åˆ¶å°è¾“å‡º**:
```
=== å¼€å§‹åˆ›å»ºå¥—é¤ ===
å½“å‰åŠŸèƒ½åˆ—è¡¨: ['AIæ™ºèƒ½ç­”ç–‘', ...]
æ‰€æœ‰è¡¨å•å€¼: {name: '...', code: '...', ...}
å‡†å¤‡æäº¤çš„å®Œæ•´æ•°æ®: {name: '...', code: '...', price: 29.90, ...}
=== å¼€å§‹è°ƒç”¨API ===
```

âœ… **åç«¯ç»ˆç«¯è¾“å‡º**:
```
åˆ›å»ºå¥—é¤è¯·æ±‚æ•°æ®: {
  'name': 'AIæ™ºèƒ½å¥—é¤',
  'code': 'ai_smart_2025',
  'description': '...',
  'price': 29.9,
  'duration_days': 30,
  'features': ['AIæ™ºèƒ½ç­”ç–‘', ...]
}
```

âœ… **æˆåŠŸæç¤º**: "å¥—é¤åˆ›å»ºæˆåŠŸï¼"
âœ… **çª—å£å…³é—­**: å‘å¯¼è‡ªåŠ¨å…³é—­
âœ… **åˆ—è¡¨æ›´æ–°**: æ–°å¥—é¤å‡ºç°åœ¨ä¼šå‘˜å¥—é¤åˆ—è¡¨ä¸­

## ğŸ› å¦‚æœä»ç„¶å¤±è´¥

### **æ£€æŸ¥æ¸…å•**ï¼š

1. **æµè§ˆå™¨ç¼“å­˜**:
   - ç¡¬åˆ·æ–°ï¼šCtrl+F5 (Windows) æˆ– Cmd+Shift+R (Mac)
   - æ¸…é™¤ç¼“å­˜åé‡æ–°åŠ è½½

2. **å‰ç«¯æ˜¯å¦è¿è¡Œ**:
   ```bash
   cd admin-frontend
   npm run dev
   ```
   - ç¡®ä¿åœ¨ `http://localhost:3000` è¿è¡Œ

3. **åç«¯æ˜¯å¦è¿è¡Œ**:
   ```bash
   python app.py
   ```
   - ç¡®ä¿åœ¨ `http://localhost:5000` è¿è¡Œ

4. **ç®¡ç†å‘˜æ˜¯å¦å·²ç™»å½•**:
   - æ£€æŸ¥å³ä¸Šè§’æ˜¯å¦æ˜¾ç¤ºç®¡ç†å‘˜ä¿¡æ¯
   - å¦‚æœªç™»å½•ï¼Œéœ€è¦å…ˆç™»å½•ç®¡ç†åå°

5. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**:
   - æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
   - æŸ¥çœ‹ Console æ ‡ç­¾é¡µçš„é”™è¯¯ä¿¡æ¯
   - æŸ¥çœ‹ Network æ ‡ç­¾é¡µçš„ POST è¯·æ±‚è¯¦æƒ…
   - æŸ¥çœ‹åç«¯ç»ˆç«¯çš„å®Œæ•´æ—¥å¿—

### **å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ**ï¼š

| é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| "å¥—é¤ä»£ç å·²å­˜åœ¨" | ä»£ç é‡å¤ | ä¿®æ”¹å¥—é¤ä»£ç ä¸ºå”¯ä¸€å€¼ |
| "è¯·è¿”å›ç¬¬1æ­¥..." | åŸºæœ¬ä¿¡æ¯æœªå¡«å†™ | ç¡®ä¿å¡«å†™äº†åç§°ã€ä»£ç ã€æè¿° |
| "è¯·è¿”å›ç¬¬2æ­¥..." | ä»·æ ¼æœªè®¾ç½® | è®¾ç½®å¤§äº0çš„ä»·æ ¼ |
| "è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªå¥—é¤åŠŸèƒ½" | åŠŸèƒ½åˆ—è¡¨ä¸ºç©º | æ·»åŠ è‡³å°‘ä¸€ä¸ªåŠŸèƒ½ |
| 400 é”™è¯¯ | æ•°æ®æ ¼å¼é”™è¯¯ | æŸ¥çœ‹åç«¯æ—¥å¿—è·å–è¯¦ç»†ä¿¡æ¯ |
| 401 é”™è¯¯ | æœªç™»å½• | é‡æ–°ç™»å½•ç®¡ç†åå° |

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### **ä¿®æ”¹çš„æ–‡ä»¶**ï¼š

1. **admin-frontend/src/api/memberships.ts**
   - æ·»åŠ  `post` å‡½æ•°å¯¼å…¥

2. **admin-frontend/src/components/CreateTierWizard.tsx**
   - å®Œå–„ `initialValues`
   - æ”¹è¿› `handleSubmit` æ•°æ®æ”¶é›†é€»è¾‘
   - å¢å¼ºè¡¨å•éªŒè¯å’Œé”™è¯¯æç¤º
   - æ·»åŠ è¯¦ç»†è°ƒè¯•æ—¥å¿—

3. **app.py**
   - æ·»åŠ è¯¦ç»†çš„åç«¯æ—¥å¿—
   - å·²æœ‰çš„åˆ›å»ºé€»è¾‘æ— éœ€ä¿®æ”¹

### **å…³é”®ä»£ç å˜æ›´**ï¼š

#### **æ•°æ®æ”¶é›†æ–¹å¼**ï¼š
```typescript
// âŒ é”™è¯¯æ–¹å¼ï¼šåªè·å–å¯è§å­—æ®µ
const values = await form.validateFields();

// âœ… æ­£ç¡®æ–¹å¼ï¼šè·å–æ‰€æœ‰å­—æ®µ
const allValues = form.getFieldsValue();
const payload = {
  name: allValues.name,
  code: allValues.code,
  // ... æ˜¾å¼æ„é€ æ‰€æœ‰å­—æ®µ
};
```

#### **åˆå§‹å€¼è®¾ç½®**ï¼š
```typescript
// âŒ ä¸å®Œæ•´
initialValues={{
  is_active: true,
}}

// âœ… å®Œæ•´
initialValues={{
  duration_days: 30,
  price: 0,
  sort_order: 0,
  is_active: true,
  // ... æ‰€æœ‰å­—æ®µ
}}
```

## âœ¨ æ”¹è¿›å»ºè®®

1. **ä¿æŒè¡¨å•æ•°æ®æŒä¹…åŒ–**: åœ¨æ­¥éª¤åˆ‡æ¢æ—¶ä¿æŒæ‰€æœ‰å­—æ®µçš„å€¼
2. **å®æ—¶éªŒè¯**: åœ¨æ¯ä¸ªæ­¥éª¤åˆ‡æ¢æ—¶éªŒè¯å½“å‰æ­¥éª¤çš„å­—æ®µ
3. **è‰ç¨¿ä¿å­˜**: å…è®¸ä¿å­˜æœªå®Œæˆçš„å¥—é¤è‰ç¨¿
4. **é¢„è§ˆåŠŸèƒ½**: åœ¨æäº¤å‰æ˜¾ç¤ºå®Œæ•´çš„å¥—é¤ä¿¡æ¯é¢„è§ˆ

## ğŸ‰ æ€»ç»“

ç»è¿‡ä»¥ä¸Šä¿®å¤ï¼Œæ–°å¢å¥—é¤åŠŸèƒ½ç°åœ¨åº”è¯¥èƒ½å¤Ÿï¼š
- âœ… æ­£ç¡®æ”¶é›†æ‰€æœ‰æ­¥éª¤çš„è¡¨å•æ•°æ®
- âœ… å‡†ç¡®éªŒè¯å¿…å¡«å­—æ®µ
- âœ… æˆåŠŸè°ƒç”¨åç«¯ API
- âœ… æ˜¾ç¤ºæ¸…æ™°çš„é”™è¯¯æç¤º
- âœ… æä¾›è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—

**ç”¨æˆ·ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨æ–°å¢å¥—é¤åŠŸèƒ½äº†ï¼** ğŸš€


