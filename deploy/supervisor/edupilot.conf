# EduPilot AI Supervisor 配置文件
# 复制到 /etc/supervisor/conf.d/edupilot.conf
# 使用方法:
#   sudo supervisorctl reread
#   sudo supervisorctl update
#   sudo supervisorctl start edupilot

[program:edupilot]
# 启动命令
command=/home/edupilot/edupilot-ai/venv/bin/gunicorn -c /home/edupilot/edupilot-ai/deploy/gunicorn/gunicorn_config.py app:app

# 工作目录
directory=/home/edupilot/edupilot-ai

# 运行用户
user=edupilot

# 进程数量（通常为1，由Gunicorn管理workers）
numprocs=1

# 自动启动
autostart=true

# 自动重启
autorestart=true

# 启动等待时间（秒）
startsecs=10

# 停止等待时间（秒）
stopwaitsecs=10

# 停止信号
stopsignal=TERM

# 重定向stderr到stdout
redirect_stderr=true

# 日志文件
stdout_logfile=/home/edupilot/edupilot-ai/logs/supervisor.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10

# 错误日志
stderr_logfile=/home/edupilot/edupilot-ai/logs/supervisor_error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10

# 环境变量
environment=
    FLASK_ENV="production",
    PATH="/home/edupilot/edupilot-ai/venv/bin:%(ENV_PATH)s",
    PYTHONPATH="/home/edupilot/edupilot-ai"

# 进程组
process_name=%(program_name)s_%(process_num)02d

# 优先级（数字越小越早启动）
priority=999

# 杀死子进程组
stopasgroup=true
killasgroup=true

# ==================== 注意事项 ====================
# 1. 修改所有路径为实际部署路径
# 2. 确保日志目录存在且有写入权限
# 3. 环境变量可以在这里设置，也可以通过.env文件
# 4. 如果使用虚拟环境，确保Python路径正确

# ==================== 常用命令 ====================
# 查看状态: sudo supervisorctl status edupilot
# 启动服务: sudo supervisorctl start edupilot
# 停止服务: sudo supervisorctl stop edupilot
# 重启服务: sudo supervisorctl restart edupilot
# 查看日志: sudo supervisorctl tail -f edupilot
# 重新加载: sudo supervisorctl reread && sudo supervisorctl update



