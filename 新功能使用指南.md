# ğŸ‰ EduPilot æ–°åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“… æ›´æ–°æ—¥æœŸï¼š2025-10-06

---

## ğŸ†• æ–°å¢åŠŸèƒ½æ¦‚è§ˆ

### 1. **AIPPTå·¥å…·åŠ¨æ€è·³è½¬** âœ…

**åŠŸèƒ½è¯´æ˜**ï¼š
- ä¿®å¤äº†ç¡¬ç¼–ç 127.0.0.1çš„é—®é¢˜
- æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡é…ç½®AIPPTæœåŠ¡åœ°å€

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# åœ¨ .env æ–‡ä»¶ä¸­é…ç½®ï¼ˆå¯é€‰ï¼‰
AIPPT_SERVICE_URL=http://your-server:5555/aippt
```

**è®¿é—®è·¯å¾„**ï¼š
- `/aippt` - è‡ªåŠ¨è·³è½¬åˆ°é…ç½®çš„AIPPTæœåŠ¡

---

### 2. **K12è¯¾ç¨‹çŸ¥è¯†åº“** âœ…âœ…âœ…

**åŠŸèƒ½è¯´æ˜**ï¼š
- è¦†ç›–å°å­¦ã€åˆä¸­ã€é«˜ä¸­å…¨éƒ¨å­¦æ®µ
- åŒ…å«è¯­æ–‡ã€æ•°å­¦ã€è‹±è¯­ã€ç‰©ç†ã€åŒ–å­¦ã€ç”Ÿç‰©ã€å†å²ã€åœ°ç†ã€æ”¿æ²»ç­‰å­¦ç§‘
- æŒ‰å­¦æ®µâ†’å¹´çº§â†’ç§‘ç›®â†’ç« èŠ‚çš„å±‚çº§ç»“æ„ç»„ç»‡

**APIæ¥å£**ï¼š

#### 2.1 è·å–æ‰€æœ‰å­¦æ®µ
```http
GET /api/courses/k12/stages
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "stages": ["å°å­¦", "åˆä¸­", "é«˜ä¸­"]
}
```

#### 2.2 è·å–æŒ‡å®šå­¦æ®µçš„å¹´çº§
```http
GET /api/courses/k12/å°å­¦/grades
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "stage": "å°å­¦",
  "grades": ["ä¸€å¹´çº§", "äºŒå¹´çº§", "ä¸‰å¹´çº§", "å››å¹´çº§", "äº”å¹´çº§", "å…­å¹´çº§"]
}
```

#### 2.3 è·å–å®Œæ•´è¯¾ç¨‹ç»“æ„
```http
GET /api/courses/k12?stage=åˆä¸­&grade=ä¸ƒå¹´çº§
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "stage": "åˆä¸­",
  "grade": "ä¸ƒå¹´çº§",
  "subjects": {
    "è¯­æ–‡": ["ç°ä»£æ–‡é˜…è¯»", "æ–‡è¨€æ–‡åŸºç¡€", "è¯—æ­Œé‰´èµ", "è®°å™æ–‡å†™ä½œ"],
    "æ•°å­¦": ["æœ‰ç†æ•°", "æ•´å¼çš„åŠ å‡", "ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹", "å‡ ä½•å›¾å½¢åˆæ­¥"],
    "è‹±è¯­": ["è¯­éŸ³ä¸è¯æ±‡", "ä¸€èˆ¬ç°åœ¨æ—¶", "ä¸€èˆ¬è¿‡å»æ—¶", "é˜…è¯»ç†è§£"],
    ...
  }
}
```

**å‰ç«¯é›†æˆç¤ºä¾‹**ï¼š
```javascript
// 1. åŠ è½½å­¦æ®µ
fetch('/api/courses/k12/stages')
  .then(res => res.json())
  .then(data => {
    const stages = data.stages;
    // æ¸²æŸ“å­¦æ®µé€‰æ‹©å™¨
  });

// 2. æ ¹æ®å­¦æ®µåŠ è½½å¹´çº§
fetch('/api/courses/k12/å°å­¦/grades')
  .then(res => res.json())
  .then(data => {
    const grades = data.grades;
    // æ¸²æŸ“å¹´çº§é€‰æ‹©å™¨
  });

// 3. åŠ è½½è¯¾ç¨‹å†…å®¹
fetch('/api/courses/k12?stage=å°å­¦&grade=ä¸€å¹´çº§')
  .then(res => res.json())
  .then(data => {
    const subjects = data.subjects;
    // æ¸²æŸ“è¯¾ç¨‹åˆ—è¡¨
  });
```

---

### 3. **æ™ºèƒ½è§†é¢‘è®²è§£åŠŸèƒ½** âœ…âœ…âœ…

**åŠŸèƒ½è¯´æ˜**ï¼š
- ä»è§†é¢‘æ–‡ä»¶æˆ–é“¾æ¥ç”Ÿæˆæ•™å­¦è®²ä¹‰
- æ”¯æŒè¯¾ç¨‹ä¿¡æ¯å®šåˆ¶ï¼ˆå­¦æ®µã€å¹´çº§ã€ç§‘ç›®ã€ç« èŠ‚ï¼‰
- å¯é€‰ç”Ÿæˆé…å¥—ç»ƒä¹ é¢˜
- è‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“

**APIæ¥å£**ï¼š

#### 3.1 ä»è§†é¢‘ç”Ÿæˆè®²ä¹‰
```http
POST /api/ai/video-to-lecture
Content-Type: multipart/form-data
```

**è¯·æ±‚å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| file | File | å¦* | è§†é¢‘æ–‡ä»¶ |
| url | String | å¦* | è§†é¢‘é“¾æ¥ |
| course_info | JSON | å¦ | è¯¾ç¨‹ä¿¡æ¯ |
| generate_exercises | Boolean | å¦ | æ˜¯å¦ç”Ÿæˆç»ƒä¹ é¢˜ |

*æ³¨ï¼šfile å’Œ url è‡³å°‘æä¾›ä¸€ä¸ª

**course_info æ ¼å¼**ï¼š
```json
{
  "stage": "åˆä¸­",
  "grade": "ä¸ƒå¹´çº§",
  "subject": "æ•°å­¦",
  "chapter": "æœ‰ç†æ•°"
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼ˆJavaScriptï¼‰**ï¼š
```javascript
// æ–¹å¼1ï¼šä»è§†é¢‘æ–‡ä»¶ç”Ÿæˆ
const formData = new FormData();
formData.append('file', videoFile);
formData.append('course_info', JSON.stringify({
  stage: 'åˆä¸­',
  grade: 'ä¸ƒå¹´çº§',
  subject: 'æ•°å­¦',
  chapter: 'æœ‰ç†æ•°'
}));
formData.append('generate_exercises', 'true');

fetch('/api/ai/video-to-lecture', {
  method: 'POST',
  body: formData,
  headers: {
    'X-CSRFToken': getCsrfToken()
  }
})
.then(res => res.json())
.then(data => {
  console.log('è®²ä¹‰å†…å®¹:', data.lecture);
  console.log('ä¿å­˜ID:', data.note_id);
});

// æ–¹å¼2ï¼šä»è§†é¢‘é“¾æ¥ç”Ÿæˆ
const formData2 = new FormData();
formData2.append('url', 'https://www.bilibili.com/video/BV1xx411c7mD');
formData2.append('course_info', JSON.stringify({
  stage: 'é«˜ä¸­',
  grade: 'é«˜ä¸€',
  subject: 'ç‰©ç†'
}));

fetch('/api/ai/video-to-lecture', {
  method: 'POST',
  body: formData2
})
.then(res => res.json())
.then(data => {
  // æ˜¾ç¤ºè®²ä¹‰
  document.getElementById('lecture-content').innerHTML = 
    marked.parse(data.lecture); // éœ€è¦ marked.js æ¸²æŸ“ Markdown
});
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "success": true,
  "lecture": "# è¯¾ç¨‹è®²ä¹‰\n\n## 1. è¯¾ç¨‹æ¦‚è¿°\n...",
  "video_identifier": "math_video.mp4",
  "course_info": {
    "stage": "åˆä¸­",
    "grade": "ä¸ƒå¹´çº§",
    "subject": "æ•°å­¦",
    "chapter": "æœ‰ç†æ•°"
  },
  "note_id": 123,
  "has_exercises": true
}
```

**å‰ç«¯é›†æˆå»ºè®®**ï¼š
1. åœ¨ã€æ™ºèƒ½è®²ä¹‰ã€‘é¡µé¢æ·»åŠ "ä»è§†é¢‘ç”Ÿæˆ"é€‰é¡¹å¡
2. æä¾›ä¸‰çº§è”åŠ¨é€‰æ‹©å™¨ï¼šå­¦æ®µ â†’ å¹´çº§ â†’ ç§‘ç›®
3. æ”¯æŒè§†é¢‘æ–‡ä»¶æ‹–æ‹½ä¸Šä¼ æˆ–URLè¾“å…¥
4. æ·»åŠ "ç”Ÿæˆé…å¥—ç»ƒä¹ "å¤é€‰æ¡†
5. ä½¿ç”¨Markdownæ¸²æŸ“å™¨æ˜¾ç¤ºç”Ÿæˆçš„è®²ä¹‰

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 4. **æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–** âœ…

**ä¼˜åŒ–å†…å®¹**ï¼š
- `Student` æ¨¡å‹ï¼š4ä¸ªå¤åˆç´¢å¼•
  - `student_id`ï¼ˆå•åˆ—ï¼‰
  - `class_name + major`ï¼ˆå¤åˆï¼‰
  - `student_status`ï¼ˆå•åˆ—ï¼‰
  - `created_at`ï¼ˆå•åˆ—ï¼‰

- `Assignment` æ¨¡å‹ï¼š4ä¸ªå¤åˆç´¢å¼•
  - `student_id`ï¼ˆå•åˆ—ï¼‰
  - `subject`ï¼ˆå•åˆ—ï¼‰
  - `submission_time`ï¼ˆå•åˆ—ï¼‰
  - `student_id + subject`ï¼ˆå¤åˆï¼‰

**æ€§èƒ½æå‡**ï¼š
- å­¦ç”Ÿåˆ—è¡¨æŸ¥è¯¢ï¼šæå‡ 40-60%
- æˆç»©ç»Ÿè®¡æŸ¥è¯¢ï¼šæå‡ 50-70%
- ç§‘ç›®ç­›é€‰ï¼šæå‡ 60-80%

---

### 5. **è¿æ¥æ± é…ç½®** âœ…

**é€‚ç”¨ç¯å¢ƒ**ï¼š
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ MySQL/PostgreSQL æ—¶è‡ªåŠ¨å¯ç”¨
- å¼€å‘ç¯å¢ƒï¼ˆSQLiteï¼‰è‡ªåŠ¨è·³è¿‡

**é…ç½®å‚æ•°**ï¼š
```python
SQLALCHEMY_ENGINE_OPTIONS = {
    'pool_size': 10,          # è¿æ¥æ± å¤§å°
    'max_overflow': 20,       # æœ€å¤§æº¢å‡ºè¿æ¥æ•°
    'pool_timeout': 30,       # è·å–è¿æ¥è¶…æ—¶ï¼ˆç§’ï¼‰
    'pool_recycle': 3600,     # è¿æ¥å›æ”¶æ—¶é—´ï¼ˆç§’ï¼‰
    'pool_pre_ping': True     # è¿æ¥å‰æµ‹è¯•
}
```

---

### 6. **æ€§èƒ½ç›‘æ§ç³»ç»Ÿ** âœ…

**åŠŸèƒ½æ¨¡å—**ï¼š
- è¯·æ±‚è®¡æ—¶ä¸­é—´ä»¶
- æ…¢è¯·æ±‚è‡ªåŠ¨è®°å½•ï¼ˆ>1ç§’ï¼‰
- æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆ>1ç§’ï¼‰
- æ€§èƒ½ç»Ÿè®¡æ•°æ®æ”¶é›†

**ä½¿ç”¨æ–¹æ³•**ï¼š

```python
# åœ¨ app.py ä¸­é›†æˆ
from utils.performance import init_performance_monitoring, performance_monitor

# åˆå§‹åŒ–æ€§èƒ½ç›‘æ§
init_performance_monitoring(app)

# è·å–æ€§èƒ½ç»Ÿè®¡
@app.route('/api/metrics')
def get_metrics():
    stats = performance_monitor.get_stats()
    return jsonify(stats)
```

**æ€§èƒ½æ•°æ®ç¤ºä¾‹**ï¼š
```json
{
  "total_requests": 1523,
  "avg_response_time": 0.234,
  "min_response_time": 0.012,
  "max_response_time": 2.456,
  "slow_requests_count": 3,
  "slow_requests": [
    {
      "path": "/api/ai/generate-lecture",
      "method": "POST",
      "duration": 2.456,
      "status_code": 200,
      "timestamp": "2025-10-06T12:34:56"
    }
  ]
}
```

---

### 7. **ç¼“å­˜ç®¡ç†ç³»ç»Ÿ** âœ…

**åŠŸèƒ½ç‰¹æ€§**ï¼š
- æ”¯æŒ Redis å’Œå†…å­˜ç¼“å­˜
- æä¾›è£…é¥°å™¨ç®€åŒ–ä½¿ç”¨
- è‡ªåŠ¨ç¼“å­˜é”®ç”Ÿæˆ
- ç¼“å­˜å¤±æ•ˆç­–ç•¥

**ä½¿ç”¨æ–¹æ³•**ï¼š

#### 7.1 åˆå§‹åŒ–ç¼“å­˜
```python
from utils.cache import CacheManager

# åœ¨ app.py ä¸­
app.cache_manager = CacheManager()  # ä½¿ç”¨å†…å­˜ç¼“å­˜
# æˆ–
app.cache_manager = CacheManager(redis_client)  # ä½¿ç”¨ Redis
```

#### 7.2 ä½¿ç”¨ç¼“å­˜è£…é¥°å™¨
```python
from utils.cache import cached, CACHE_MEDIUM, CACHE_LONG

# ç¼“å­˜å‡½æ•°ç»“æœï¼ˆ5åˆ†é’Ÿï¼‰
@cached(timeout=CACHE_MEDIUM, key_prefix='students')
def get_all_students():
    return Student.query.all()

# ç¼“å­˜APIå“åº”ï¼ˆ30åˆ†é’Ÿï¼‰
@app.route('/api/courses/k12')
@cached(timeout=CACHE_LONG, key_prefix='k12_courses')
def get_k12_courses():
    return jsonify(K12_COURSE_STRUCTURE)
```

#### 7.3 æ‰‹åŠ¨ç¼“å­˜æ“ä½œ
```python
from flask import current_app

# è®¾ç½®ç¼“å­˜
current_app.cache_manager.set('user:123', user_data, timeout=600)

# è·å–ç¼“å­˜
user_data = current_app.cache_manager.get('user:123')

# åˆ é™¤ç¼“å­˜
current_app.cache_manager.delete('user:123')

# æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
current_app.cache_manager.clear()
```

**ç¼“å­˜æ—¶é—´å¸¸é‡**ï¼š
```python
CACHE_SHORT = 60          # 1åˆ†é’Ÿ
CACHE_MEDIUM = 300        # 5åˆ†é’Ÿ
CACHE_LONG = 1800         # 30åˆ†é’Ÿ
CACHE_VERY_LONG = 3600    # 1å°æ—¶
CACHE_DAY = 86400         # 1å¤©
```

---

## ğŸ“ å¾…åŠäº‹é¡¹ï¼ˆå¯é€‰ï¼‰

### ä¸‹ä¸€é˜¶æ®µä¼˜åŒ–å»ºè®®ï¼š

1. **ç¼“å­˜é›†æˆåº”ç”¨**
   - ä¸ºé«˜é¢‘APIæ·»åŠ ç¼“å­˜è£…é¥°å™¨
   - é…ç½®Redisï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

2. **APIè°ƒç”¨ä¼˜åŒ–**
   - æ·»åŠ è¶…æ—¶æ§åˆ¶ï¼ˆ30ç§’ï¼‰
   - å®ç°é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰

3. **é™æ€èµ„æºä¼˜åŒ–**
   - é…ç½®æµè§ˆå™¨ç¼“å­˜å¤´
   - å®ç°CDNæ”¯æŒ

4. **ç›‘æ§å®Œå–„**
   - åˆ›å»º `/api/metrics` ç«¯ç‚¹
   - æ·»åŠ å‘Šè­¦æœºåˆ¶

---

## ğŸ¯ å¿«é€Ÿæµ‹è¯•

### æµ‹è¯•K12è¯¾ç¨‹API
```bash
# è·å–æ‰€æœ‰å­¦æ®µ
curl http://localhost:5000/api/courses/k12/stages

# è·å–å°å­¦çš„å¹´çº§
curl http://localhost:5000/api/courses/k12/å°å­¦/grades

# è·å–åˆä¸­ä¸ƒå¹´çº§çš„è¯¾ç¨‹
curl "http://localhost:5000/api/courses/k12?stage=åˆä¸­&grade=ä¸ƒå¹´çº§"
```

### æµ‹è¯•è§†é¢‘è®²è§£API
```bash
# ä½¿ç”¨è§†é¢‘URL
curl -X POST http://localhost:5000/api/ai/video-to-lecture \
  -H "Content-Type: multipart/form-data" \
  -F "url=https://www.bilibili.com/video/BV1xx411c7mD" \
  -F 'course_info={"stage":"åˆä¸­","grade":"ä¸ƒå¹´çº§","subject":"æ•°å­¦"}' \
  -F "generate_exercises=true"
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- ç³»ç»Ÿæ—¥å¿—ï¼š`logs/app.log`
- é”™è¯¯æ—¥å¿—ï¼š`logs/error.log`
- éƒ¨ç½²æ–‡æ¡£ï¼š`DEPLOYMENT.md`

---

**æœ€åæ›´æ–°**ï¼š2025-10-06
**ç‰ˆæœ¬**ï¼šv3.0.0
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡


