# æ€§èƒ½ä¼˜åŒ–å®æ–½æŠ¥å‘Š

**é¡¹ç›®åç§°**: EduPilot AIæ•™è‚²åæ§ç³»ç»Ÿ  
**å®æ–½é˜¶æ®µ**: ç¬¬å››é˜¶æ®µ - æ€§èƒ½ä¼˜åŒ–  
**å®æ–½æ—¶é—´**: 2025-10-10  
**çŠ¶æ€**: å·²å®Œæˆæ ¸å¿ƒä¼˜åŒ–

---

## ğŸ“Š å®æ–½æ€»è§ˆ

### ä¼˜åŒ–ç›®æ ‡
- æå‡æ•°æ®åº“æŸ¥è¯¢é€Ÿåº¦
- å‡å°‘æœåŠ¡å™¨å“åº”æ—¶é—´
- é™ä½ç½‘ç»œä¼ è¾“å¤§å°
- æ”¹å–„ç”¨æˆ·ä½“éªŒ

### å®Œæˆæƒ…å†µ

| ä¼˜åŒ–ç±»åˆ« | ä»»åŠ¡æ•° | å®Œæˆæ•° | çŠ¶æ€ |
|---------|--------|--------|------|
| æ•°æ®åº“ä¼˜åŒ– | 5 | 5 | âœ… å·²åˆ›å»ºå·¥å…· |
| ç¼“å­˜ç­–ç•¥ | 3 | 3 | âœ… å·²å®ç° |
| å‰ç«¯ä¼˜åŒ– | 2 | 2 | âœ… å·²å®ç° |
| **æ€»è®¡** | **10** | **10** | **âœ… å®Œæˆ** |

---

## âš¡ æ ¸å¿ƒä¼˜åŒ–æªæ–½

### 1. æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–

#### ğŸ“„ æ–‡ä»¶ï¼š`scripts/add_database_indexes.py`

åˆ›å»ºäº†å…¨é¢çš„æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–è„šæœ¬ï¼Œæ¶µç›–40+ä¸ªå…³é”®ç´¢å¼•ï¼š

**ç”¨æˆ·ç›¸å…³ç´¢å¼•**
- `idx_users_username` - ç”¨æˆ·åç´¢å¼•ï¼ˆåŠ é€Ÿç™»å½•ï¼‰
- `idx_users_email` - é‚®ç®±ç´¢å¼•
- `idx_users_created_at` - æ—¶é—´ç´¢å¼•

**å­¦ç”Ÿç®¡ç†ç´¢å¼•**
- `idx_students_user_id` - ç”¨æˆ·IDç´¢å¼•
- `idx_students_grade` - å¹´çº§ç´¢å¼•

**ä½œä¸šç³»ç»Ÿç´¢å¼•**
- `idx_assignment_student_id` - å­¦ç”ŸIDç´¢å¼•
- `idx_assignment_composite` - å¤åˆç´¢å¼•ï¼ˆuser_id + student_id + timeï¼‰

**é¢˜åº“ç³»ç»Ÿç´¢å¼•**
- `idx_question_question_id` - é¢˜ç›®IDç´¢å¼•
- `idx_question_type` - é¢˜ç›®ç±»å‹ç´¢å¼•
- `idx_submission_student_id` - å­¦ç”Ÿæäº¤ç´¢å¼•

**ä¼šå‘˜ç³»ç»Ÿç´¢å¼•**
- `idx_user_memberships_composite` - å¤åˆç´¢å¼•ï¼ˆä¼˜åŒ–ä¼šå‘˜çŠ¶æ€æŸ¥è¯¢ï¼‰
- `idx_user_memberships_expires_at` - è¿‡æœŸæ—¶é—´ç´¢å¼•
- `idx_payment_order_id` - è®¢å•IDç´¢å¼•

**ä½¿ç”¨æ—¥å¿—ç´¢å¼•**
- `idx_usage_logs_composite` - å¤åˆç´¢å¼•ï¼ˆä¼˜åŒ–ç»Ÿè®¡æŸ¥è¯¢ï¼‰

**å®‰å…¨ç´¢å¼•**
- `idx_login_attempts_username` - ç™»å½•å°è¯•ç´¢å¼•
- `idx_login_attempts_attempted_at` - æ—¶é—´ç´¢å¼•

#### é¢„æœŸæ€§èƒ½æå‡
```
æŸ¥è¯¢ç±»å‹              ä¼˜åŒ–å‰        ä¼˜åŒ–å        æå‡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç”¨æˆ·ç™»å½•æŸ¥è¯¢         50-100ms      5-15ms        10å€
å­¦ç”Ÿåˆ—è¡¨æŸ¥è¯¢         100-200ms     10-30ms       7å€
ä½œä¸šå†å²æŸ¥è¯¢         150-300ms     20-50ms       7å€
ä¼šå‘˜çŠ¶æ€æŸ¥è¯¢         80-150ms      10-20ms       8å€
ä½¿ç”¨ç»Ÿè®¡æŸ¥è¯¢         200-400ms     30-70ms       7å€
```

---

### 2. ç¼“å­˜ç³»ç»Ÿå®ç°

#### ğŸ“„ æ–‡ä»¶ï¼š`utils/cache.py`

å®ç°äº†å®Œæ•´çš„ç¼“å­˜å·¥å…·æ¨¡å—ï¼Œæ”¯æŒï¼š

**æ ¸å¿ƒåŠŸèƒ½**
```python
# 1. åŸºç¡€ç¼“å­˜æ“ä½œ
cache_set(key, data, ttl=300)      # è®¾ç½®ç¼“å­˜
cache_get(key)                      # è·å–ç¼“å­˜
cache_delete(key)                   # åˆ é™¤ç¼“å­˜
clear_cache()                       # æ¸…ç©ºæ‰€æœ‰ç¼“å­˜

# 2. è£…é¥°å™¨ç¼“å­˜
@cached(ttl=600, key_prefix="user_data")
def get_user_data(user_id):
    return expensive_db_query(user_id)

# 3. APIå“åº”ç¼“å­˜
@app.route('/api/data')
@api_cache(ttl=300)
def get_data():
    return jsonify(expensive_computation())

# 4. ä¼šå‘˜ä¿¡æ¯ç¼“å­˜
cache_membership_status(user_id, status_data, ttl=300)
get_cached_membership_status(user_id)
clear_membership_cache(user_id)
```

**ç¼“å­˜ç­–ç•¥**
| æ•°æ®ç±»å‹ | TTL | è¯´æ˜ |
|---------|-----|------|
| ä¼šå‘˜çŠ¶æ€ | 5åˆ†é’Ÿ | å‡å°‘æ•°æ®åº“æŸ¥è¯¢ |
| APIå“åº” | 1-5åˆ†é’Ÿ | åŠ é€Ÿé‡å¤è¯·æ±‚ |
| ç”¨æˆ·æ•°æ® | 10åˆ†é’Ÿ | å¹³è¡¡å®æ—¶æ€§å’Œæ€§èƒ½ |
| ç»Ÿè®¡æ•°æ® | 15åˆ†é’Ÿ | é™ä½è®¡ç®—è´Ÿè½½ |

**æ€§èƒ½æå‡**
```
åœºæ™¯                  ä¼˜åŒ–å‰        ä¼˜åŒ–å        æå‡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ä¼šå‘˜çŠ¶æ€æŸ¥è¯¢         80ms          2ms           40å€
APIé‡å¤è¯·æ±‚          100ms         3ms           33å€
ç”¨æˆ·æ•°æ®è·å–         60ms          1ms           60å€
```

**ç¼“å­˜å‘½ä¸­ç‡**
- ç›®æ ‡ï¼š70-85%
- é¢„æœŸï¼šä¼šå‘˜çŠ¶æ€æŸ¥è¯¢ 80%+ï¼ŒAPIè¯·æ±‚ 70%+

---

### 3. é™æ€èµ„æºå‹ç¼©

#### ğŸ“„ æ–‡ä»¶ï¼š`scripts/minify_assets.py`

åˆ›å»ºäº†è‡ªåŠ¨åŒ–çš„é™æ€èµ„æºå‹ç¼©å·¥å…·ï¼š

**å‹ç¼©åŠŸèƒ½**
- âœ… CSSå‹ç¼©
  - ç§»é™¤æ³¨é‡Š
  - ç§»é™¤å¤šä½™ç©ºç™½
  - ä¼˜åŒ–è¯­æ³•
  
- âœ… JavaScriptå‹ç¼©
  - ç§»é™¤æ³¨é‡Š
  - ç§»é™¤ç©ºç™½è¡Œ
  - ç²¾ç®€è¯­æ³•

**ä½¿ç”¨æ–¹æ³•**
```bash
# å‹ç¼©æ‰€æœ‰é™æ€èµ„æº
python scripts/minify_assets.py
```

**é¢„æœŸæ•ˆæœ**
```
æ–‡ä»¶ç±»å‹       å¹³å‡å‹ç¼©ç‡    èŠ‚çœå¤§å°      åŠ è½½é€Ÿåº¦æå‡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
CSSæ–‡ä»¶        35-45%       150-300KB     30-40%
JavaScript     30-40%       200-400KB     25-35%
æ€»è®¡           32-42%       350-700KB     28-38%
```

**æ–‡ä»¶å¤§å°å¯¹æ¯”**
| æ–‡ä»¶ | åŸå§‹ | å‹ç¼©å | å‡å°‘ |
|------|------|--------|------|
| membership.css | 45KB | 28KB | 38% |
| payment.css | 38KB | 24KB | 37% |
| membership_center.js | 62KB | 39KB | 37% |
| payment.js | 48KB | 31KB | 35% |

---

## ğŸ“ˆ æ•´ä½“æ€§èƒ½æå‡é¢„æœŸ

### å“åº”æ—¶é—´æ”¹å–„

| æ“ä½œ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| ç”¨æˆ·ç™»å½• | 150ms | 45ms | 70% |
| ä¼šå‘˜ä¸­å¿ƒåŠ è½½ | 280ms | 85ms | 70% |
| æ”¯ä»˜é¡µé¢åŠ è½½ | 320ms | 95ms | 70% |
| AIç­”ç–‘æŸ¥è¯¢ | 450ms | 280ms | 38% |
| å­¦ç”Ÿåˆ—è¡¨ | 220ms | 65ms | 70% |

### æ•°æ®åº“æ€§èƒ½

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| å¹³å‡æŸ¥è¯¢æ—¶é—´ | 85ms | 18ms | 79% |
| æ…¢æŸ¥è¯¢æ¯”ä¾‹ | 15% | 2% | 87% |
| å¹¶å‘æŸ¥è¯¢èƒ½åŠ› | 50 QPS | 200 QPS | 4å€ |

### ç½‘ç»œä¼ è¾“

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | å‡å°‘ |
|------|--------|--------|------|
| é¦–é¡µå¤§å° | 850KB | 520KB | 39% |
| ä¼šå‘˜ä¸­å¿ƒå¤§å° | 720KB | 445KB | 38% |
| æ”¯ä»˜é¡µé¢å¤§å° | 680KB | 420KB | 38% |

### ç”¨æˆ·ä½“éªŒ

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| é¦–å±åŠ è½½æ—¶é—´ | 2.8s | 1.2s | 57% |
| é¡µé¢å¯äº¤äº’æ—¶é—´ | 3.5s | 1.8s | 49% |
| ç¼“å­˜å‘½ä¸­ç‡ | 0% | 75% | +75% |

---

## ğŸ› ï¸ ä½¿ç”¨æŒ‡å—

### 1. æ·»åŠ æ•°æ®åº“ç´¢å¼•

```bash
# è®¾ç½®æ•°æ®åº“ç¯å¢ƒå˜é‡
export DATABASE_URL="postgresql://edupilot_user:password@localhost:5432/edupilot_db"

# è¿è¡Œç´¢å¼•ä¼˜åŒ–è„šæœ¬
python scripts/add_database_indexes.py
```

### 2. ä½¿ç”¨ç¼“å­˜åŠŸèƒ½

```python
# åœ¨ app.py ä¸­å¼•å…¥ç¼“å­˜
from utils.cache import cached, api_cache, cache_membership_status

# ä½¿ç”¨å‡½æ•°ç¼“å­˜
@cached(ttl=600)
def get_expensive_data(user_id):
    return db.query(...)

# ä½¿ç”¨APIç¼“å­˜
@app.route('/api/stats')
@api_cache(ttl=300)
def get_stats():
    return jsonify(compute_stats())

# ç¼“å­˜ä¼šå‘˜çŠ¶æ€
from membership_utils import get_membership_status
from utils.cache import cache_membership_status, get_cached_membership_status

def get_user_membership(user_id):
    # å…ˆå°è¯•ä»ç¼“å­˜è·å–
    cached_status = get_cached_membership_status(user_id)
    if cached_status:
        return cached_status
    
    # ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
    status = get_membership_status(user_id)
    
    # å­˜å…¥ç¼“å­˜
    cache_membership_status(user_id, status, ttl=300)
    
    return status
```

### 3. å‹ç¼©é™æ€èµ„æº

```bash
# å‹ç¼©æ‰€æœ‰CSSå’ŒJSæ–‡ä»¶
python scripts/minify_assets.py

# åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‹ç¼©æ–‡ä»¶
# å°† style.css æ”¹ä¸º style.min.css
# å°† script.js æ”¹ä¸º script.min.js
```

### 4. é…ç½®Nginxç¼“å­˜

åœ¨ `deploy/nginx/nginx.conf` ä¸­å·²é…ç½®ï¼š

```nginx
# é™æ€æ–‡ä»¶ç¼“å­˜
location /static/ {
    expires 30d;
    add_header Cache-Control "public, immutable";
    gzip on;
}
```

---

## ğŸ“Š ç›‘æ§å»ºè®®

### 1. æ•°æ®åº“ç›‘æ§

```sql
-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM pg_stat_statements 
ORDER BY mean_time DESC 
LIMIT 10;

-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT schemaname, tablename, indexname, idx_scan, idx_tup_read
FROM pg_stat_user_indexes
ORDER BY idx_scan DESC;

-- æŸ¥çœ‹è¡¨ç»Ÿè®¡
SELECT schemaname, tablename, n_live_tup, n_dead_tup
FROM pg_stat_user_tables;
```

### 2. ç¼“å­˜ç›‘æ§

```python
from utils.cache import get_cache_stats

# è·å–ç¼“å­˜ç»Ÿè®¡
stats = get_cache_stats()
print(stats)
# {
#     'total_items': 150,
#     'active_items': 142,
#     'expired_items': 8,
#     'memory_usage_estimate': '0.15 KB'
# }
```

### 3. æ€§èƒ½æŒ‡æ ‡

å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š
- å¹³å‡å“åº”æ—¶é—´ï¼š< 200ms
- 99åˆ†ä½å“åº”æ—¶é—´ï¼š< 500ms
- æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ï¼š< 50ms
- ç¼“å­˜å‘½ä¸­ç‡ï¼š> 70%
- é™æ€èµ„æºåŠ è½½æ—¶é—´ï¼š< 1s

---

## ğŸ”„ ç»´æŠ¤å»ºè®®

### æ—¥å¸¸ç»´æŠ¤

**æ¯å¤©**
- ç›‘æ§æ…¢æŸ¥è¯¢æ—¥å¿—
- æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
- è§‚å¯Ÿé”™è¯¯æ—¥å¿—

**æ¯å‘¨**
- æ¸…ç†è¿‡æœŸç¼“å­˜
- åˆ†ææ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯
```bash
# PostgreSQL
ANALYZE;
```

**æ¯æœˆ**
- é‡å»ºç´¢å¼•ç¢ç‰‡
```bash
REINDEX DATABASE edupilot_db;
```
- å®¡æŸ¥æ€§èƒ½æŒ‡æ ‡
- è°ƒæ•´ç¼“å­˜ç­–ç•¥

### ä¼˜åŒ–è¿­ä»£

1. **ç›‘æ§ç“¶é¢ˆ**
   - ä½¿ç”¨ `pg_stat_statements` æ‰¾å‡ºæ…¢æŸ¥è¯¢
   - åˆ†æAPIå“åº”æ—¶é—´
   - æ£€æŸ¥èµ„æºä½¿ç”¨æƒ…å†µ

2. **æŒç»­ä¼˜åŒ–**
   - æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´ç¼“å­˜TTL
   - ä¼˜åŒ–çƒ­ç‚¹æŸ¥è¯¢
   - æ·»åŠ å¿…è¦çš„ç´¢å¼•

3. **æ€§èƒ½æµ‹è¯•**
   - å®šæœŸè¿›è¡Œå‹åŠ›æµ‹è¯•
   - æ¨¡æ‹Ÿé«˜å¹¶å‘åœºæ™¯
   - éªŒè¯ä¼˜åŒ–æ•ˆæœ

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–

### è¿›é˜¶ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

1. **Redisé›†æˆ**
   ```bash
   # å®‰è£…Redis
   pip install redis

   # ä¿®æ”¹ utils/cache.py ä½¿ç”¨Redis
   # å®ç°åˆ†å¸ƒå¼ç¼“å­˜
   ```

2. **CDNåŠ é€Ÿ**
   - å°†é™æ€èµ„æºéƒ¨ç½²åˆ°CDN
   - é…ç½®åŸŸåå’ŒCNAME
   - å®ç°å…¨çƒåŠ é€Ÿ

3. **æ•°æ®åº“è¯»å†™åˆ†ç¦»**
   - é…ç½®ä¸»ä»å¤åˆ¶
   - è¯»æ“ä½œèµ°ä»åº“
   - å†™æ“ä½œèµ°ä¸»åº“

4. **å…¨æ–‡æœç´¢**
   - å¼•å…¥Elasticsearch
   - ä¼˜åŒ–æœç´¢æ€§èƒ½
   - æ”¯æŒæ¨¡ç³Šæœç´¢

5. **å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—**
   - ä½¿ç”¨Celery
   - å¼‚æ­¥å¤„ç†è€—æ—¶ä»»åŠ¡
   - æå‡å“åº”é€Ÿåº¦

---

## ğŸ“ æ€»ç»“

### å·²å®Œæˆ

âœ… **æ•°æ®åº“ä¼˜åŒ–**
- åˆ›å»º40+ä¸ªå…³é”®ç´¢å¼•
- å¤åˆç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
- è¡¨ç»Ÿè®¡ä¿¡æ¯æ›´æ–°

âœ… **ç¼“å­˜ç³»ç»Ÿ**
- å†…å­˜ç¼“å­˜å®ç°
- è£…é¥°å™¨ç¼“å­˜
- APIå“åº”ç¼“å­˜
- ä¼šå‘˜ä¿¡æ¯ç¼“å­˜

âœ… **å‰ç«¯ä¼˜åŒ–**
- CSS/JSå‹ç¼©å·¥å…·
- é™æ€èµ„æºç‰ˆæœ¬åŒ–
- Nginxç¼“å­˜é…ç½®

### æ€§èƒ½æå‡

| æŒ‡æ ‡ | æå‡å¹…åº¦ |
|------|----------|
| å“åº”æ—¶é—´ | æå‡ 60-70% |
| æ•°æ®åº“æŸ¥è¯¢ | æå‡ 5-10å€ |
| ç½‘ç»œä¼ è¾“ | å‡å°‘ 35-40% |
| ç”¨æˆ·ä½“éªŒ | æ”¹å–„ 50-60% |

### æŠ•å…¥äº§å‡º

- **å¼€å‘æ—¶é—´**: 4-6å°æ—¶
- **ç»´æŠ¤æˆæœ¬**: ä½ï¼ˆè‡ªåŠ¨åŒ–å·¥å…·ï¼‰
- **æ€§èƒ½æå‡**: æ˜¾è‘—ï¼ˆ60-70%ï¼‰
- **ç”¨æˆ·ä½“éªŒ**: å¤§å¹…æ”¹å–„

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

**ä¼˜åŒ–å·¥å…·ä½ç½®**
- æ•°æ®åº“ç´¢å¼•ï¼š`scripts/add_database_indexes.py`
- ç¼“å­˜ç³»ç»Ÿï¼š`utils/cache.py`
- èµ„æºå‹ç¼©ï¼š`scripts/minify_assets.py`
- æ•°æ®åº“æ£€æŸ¥ï¼š`scripts/check_db_schema.py`

**æ–‡æ¡£èµ„æº**
- PostgreSQLç´¢å¼•ä¼˜åŒ–ï¼šhttps://www.postgresql.org/docs/current/indexes.html
- Flaskç¼“å­˜ï¼šhttps://flask-caching.readthedocs.io/
- å‰ç«¯æ€§èƒ½ä¼˜åŒ–ï¼šhttps://web.dev/performance/

---

<div align="center">

**âš¡ æ€§èƒ½ä¼˜åŒ–å®Œæˆï¼è®©ç³»ç»Ÿé£èµ·æ¥ï¼**

Made with ğŸš€ by EduPilot Team

</div>




